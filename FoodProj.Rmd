---
title: "440-FinalProj"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
https://www.kaggle.com/datasets/mariaren/covid19-healthy-diet-dataset?resource=download&select=Food_Supply_Quantity_kg_Data.csv
 
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7306972/ 

https://www.hsph.harvard.edu/nutritionsource/nutrition-and-immunity/

https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7919160/

https://www.cdc.gov/coronavirus/2019-ncov/need-extra-precautions/people-with-medical-conditions.html 

https://www.cdc.gov/healthyweight/index.html
```{r}
library(tidyverse)
```

## Introduction

When the novel coronavirus (COVID-19) pandemic spread through the world in late 2019 and 2020, it caused quarantines resulting in worldwide shutdowns of travel and commerce. Despite many limitations on travel, mask mandates, testing protocols, and social distancing requirements, the disease still caused shortages in hospital resources, including PPE, ventilators, and ICU beds. For example, the pandemic has caused up to 300,000 people in the US needing ICU beds simultaneously, while estimates for total ICU beds in the US are around 100,000. 

The pervasiveness of the disease begs the question whether or not individual behaviors and life choices can decrease one's risk of either contracting or dying from the disease. Obesity, for example, is associated with higher rates of severe illness from COVID-19 (https://www.cdc.gov/coronavirus/2019-ncov/need-extra-precautions/people-with-medical-conditions.html). While obesity is influenced by genetic and environmental factors, it can be controlled by lifestyle choices such as exercise and healthy eating. 

On the topic of healthy eating, Harvard T.H. Chan School of Public Health says that a "balanced diet consisting of a range of vitamins and minerals, combined with healthy lifestyle factors... most effectively primes the body to fight infection and disease." As a result, I am interested in whether or not dietary choices can effect rates of contracting COVID-19 or rates of serious illness/death.

My data is called the COVID-19 Healthy Diet Dataset and comes from Kaggle courtesy of user Maria Ren, and was last updated the week of 02/06/2021, giving plenty of data from the COVID-19 pandemic to work with. There are 4 datasets provided, each of which contains information about a part of people's diet. One contains information about people's consumption of fat, another for protein, another for overall food intake (in kg), and another for overall food intake (in kcal). Each dataset has 170 rows (countries) and the same 32 columns. There is a column for country name and many different columns representing food groups that contain information about what percentage of people's diet (in the category defined by the dataset it comes from) that each food group takes up. For example, the animal fats column in the Fats dataset represents the percentage of a countries total fat intake that is comprised of animal fats. Meanwhile, the column animal fats in the Overall Food Intake (kg) dataset will represent the percentage of countries total food intake in kg that is comprised of animal fats. In addition, there are columns (I will refer to these following columns as demographic/outcome information) for obesity rate, undernourished rate, confirmed COVID-19 case rate, COVID-19 death rate, active COVID-19 case rate, and total population. All of the rates are calculated as percentage of total population, for example, confirmed COVID-19 case rate in a country is the percent of people in that country that have COVID-19. The demographic/outcome information is identical for all 4 datasets. 

The 4 datasets were combined by joining them together on the country field (all the countries in the 4 sets are the same), and deleting the duplicate demographic/outcome information.



https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8954090/



```{r}
fat <- read.csv("Fat_Supply_Quantity_Data.csv")
food_kg <- read.csv("Food_Supply_Quantity_kg_Data.csv")
food_cal <- read.csv("Food_Supply_kcal_Data.csv")
protein <- read.csv("Protein_Supply_Quantity_Data.csv")
```

```{r}

fat <- fat %>% 
  select(-c(Obesity, Undernourished, Confirmed, Deaths, Recovered, Active, Population, Unit..all.except.Population.))
names <- colnames(fat)
for (i in seq(length(names)-1)) {
  names[i+1] <- paste0(names[i+1], "_fat")
}
colnames(fat) <- names

food_kg <- food_kg %>% 
  select(-c(Obesity, Undernourished, Confirmed, Deaths, Recovered, Active, Population, Unit..all.except.Population.))
names <- colnames(food_kg)
for (i in seq(length(names)-1)) {
  names[i+1] <- paste0(names[i+1], "_food_kg")
}
colnames(food_kg) <- names

protein <- protein %>% 
  select(-c(Obesity, Undernourished, Confirmed, Deaths, Recovered, Active, Population, Unit..all.except.Population.))
names <- colnames(protein)
for (i in seq(length(names)-1)) {
  names[i+1] <- paste0(names[i+1], "_protein")
}
colnames(protein) <- names

merged <- merge(fat, food_kg, by = "Country", all = TRUE)

merged <- merge(merged, protein, by = "Country", all = TRUE)

merged <- merge(merged, food_cal, by = "Country", all = TRUE)

print(merged)

merged <- merged %>%
  mutate(Animal_no_seafood_fat = Animal.Products_fat - Fish..Seafood_fat) %>%
  mutate(Vegetal_no_oil_fat = Vegetal.Products_fat - Vegetable.Oils_fat) %>%
  mutate(Animal_no_seafood_protein = Animal.Products_protein - Fish..Seafood_fat) %>%
  mutate(Vegetal_no_oil_protein = Vegetal.Products_protein - Vegetable.Oils_protein)


print(merged)


```

### EDA

```{r}
ggplot(data = merged, aes(x = Animal.Products_fat, y = Deaths, color = Obesity)) + geom_point() + scale_color_gradient(low="black", high="yellow") + labs()

ggplot(data = merged, aes(x = Animal.fats, y = Deaths, color = Obesity)) + geom_point() + scale_color_gradient(low="black", high="yellow") + labs()

ggplot(data = merged, aes(x = Fruits...Excluding.Wine, y = Deaths, color = Obesity)) + geom_point() + scale_color_gradient(low="black", high="yellow") + labs()
```

## Methodology

### Missing Data
```{r}
merged %>% 
  filter_all(any_vars(is.na(.))) %>% 
  select(Country, Obesity, Undernourished, Confirmed, Deaths, Recovered, Active)
```
<!-- 16 of the 170 countries in the dataset contain missing values. All missing values occur in either the variables for rates of obesity, undernourishedness, confirmed cases, deaths, recovered cases, and active cases. Missing data in the confirmed cases, deaths, recovered cases, and active cases seem to be highly related. Other than two observations where only data for active cases is missing, a missing value in any of the four fields is always accompanied by missing values in all three other fields. Because these four fields are the main response variables I am interested in, I decided against imputing cases with all four response variables missing. Missing all four response variables leads to less information I could use to impute compared to if only one of the response variables was missing, and in addition the countries with all four response variables are generally either very small countries or weird cases such as North Korea. Due to these two facts, I thought it may be difficult to obtain accurate imputations in these cases and so I decided against imputation for these cases.  -->


16 of the 170 countries in the dataset contain missing values. All missing values occur in either the variables for rates of obesity, undernourishedness, confirmed cases, deaths, recovered cases, and active cases. Missing data in the confirmed cases, deaths, recovered cases, and active cases seem to be highly related. Other than two observations where only data for active cases is missing, a missing value in any of the four fields is always accompanied by missing values in all three other fields. Generally speaking, most countries with missing values are either countries with very small populations or are special cases such as Taiwan or North Korea. I assume this data is MAR since it seems like the missing values are mostly explained by something observed in the data (population). Unfortunately, MICE imputation does not work due to singular values occurring during imputation, even when experimenting with taking out certain problematic columns. As a result, I will drop these 16 observations with missing values, but will keep in mind that this will bias the results. 

```{r}
library(mice)
merged_test <- merged %>% 
  select(-c(Alcoholic.Beverages_fat, Aquatic.Products..Other_fat, Sugar.Crops_fat, Sugar...Sweeteners_fat, Aquatic.Products..Other_food_kg, Sugar.Crops_food_kg, Aquatic.Products..Other_protein, Sugar.Crops_protein, Sugar...Sweeteners_protein, Aquatic.Products..Other, Sugar.Crops, Unit..all.except.Population., Obesity))


# 
# imputed_Data <- mice(merged, m=5, maxit = 50, method = 'pmm', seed = 500)
# summary(imputed_Data)
  
```

### Model formulation/selection

I decided to concentrate on two response variables in particular, rates of COVID-19 related deaths and confirmed cases. I will fit two models, one for each response variable. I am mostly interested in the relationship between each of the four predictor variables vegetable, fruit, meat, and animal fat consumption as a percentage of total food consumed (in kcal) and the response variables. These variables will go into my model. I also decided to control for the consumption of other dietary food groups as a percentage of total food consumed (in kcal). As a result, I also added variables for alcoholic beverages, cereals (wheat, rice, and other grain products), eggs, fish and seafood, milk, offals, oilcrops (including coconuts, peanuts, rapeseed, mustardseed, sunflower seeds, soybeans, etc.), pulses (legumes), spices, starchy root vegetables, spices, stimulants (including coffee, tea, and cacao products), tree nuts, vegetable oils, sugar and sweeteners, and finally miscellaneous, all representing percentage of total food consumed in kcal in order to control for these effects. 

In addition, given that there was data available for the percentage of total protein and fats each of the food groups took up, I decided to also control for these. However, in the interest of being parsimonious, I used variables representing larger food groups to control for them. I added in variables for percentage of total fat intake from animal products (not including seafood), seafood, vegetal products (any plant related products not including oils), and vegetable oils. Similar variables were added to the model but instead of fat, they measured percentage of total protein intake. 

Lastly, I also added in variables for obesity rate and population to control for these factors as well.  



```{r}
model <- lm(Deaths~ Animal_no_seafood_fat+ Fish..Seafood_fat + Vegetal_no_oil_fat + Vegetable.Oils_fat + Animal_no_seafood_protein+ Fish..Seafood_protein + Vegetal_no_oil_protein + Vegetable.Oils_protein + Alcoholic.Beverages + Animal.fats  + Cereals...Excluding.Beer + Eggs + Fish..Seafood + Meat +  Fruits...Excluding.Wine + Milk...Excluding.Butter + Miscellaneous + Offals + Oilcrops + Pulses + Spices + Starchy.Roots + Stimulants + Sugar...Sweeteners + Treenuts + Vegetable.Oils + Vegetables + Obesity + Population, data = merged)

summary(model)
```

